{% extends "layout.html" %} {% block title %}Series Lite Plot{% endblock
%} {% block body %}

<link href="static/css/nv.d3.css" rel="stylesheet" type="text/css">
<script src="static/js/nv.d3.min.js"></script>

<style>
#side-container {
	width: 100px;
}

#side-container-4 {
	background: #cbcbcb;
}

section {
	border: 0px;
	padding: 5px 0;
}

#legend {
	background: inherit;
	height: inherit;
}

#side_panel {
	padding: 0px;
}

svg {
	overflow: hidden;
	height: 600px;
	width:955px;
}
</style>

<h1>Explore Series Lite</h1>
<div id="container">

	<div id="main-container" style="width: 960px;">
		<div id="svg-box">
			<svg></svg>
		</div>
	</div>
	<div id="side-container">
		<div class="side-container {{message_class}}" id="side-container-3">{{message}}</div>
		<div class="side-container" id="side-container-0">{{title}}</div>
		<div class="side-container" id="side-container-2">
			Built with <a href="http://d3js.org/">d3.js</a>.
		</div>
	</div>
</div>

<script>

	function isNumber(n) {
		return !isNaN(parseFloat(n)) && isFinite(n);
	}	
	var str2int = function(d){return +d;};
	var month2int = function(d){ d = d.split(/[- :]/); return (new Date(d[0], d[1]-1, 0));};
	var date2int = function(d){ d = d.split(/[- :]/); return (new Date(d[0], d[1]-1, d[2]));};
	var time2int = function(d){ d = d.split(/[- :]/);  return new Date(d[0], d[1]-1, d[2], d[3], d[4], d[5]);};

nv.addGraph(function() {
	var margin = {top: 20, right: 40, bottom: 40, left: 60},
	    width = 955,
	    height = 600;

  	var chart = nv.models.lineWithFocusChart()
  		.width(width)
		.height(height)
		.margin(margin)
 		.color(d3.scale.category10().range());
  	
  	d3.text("{{datfile}}", function(text) {
  		var data = d3.csv.parseRows(text);
  		var fdata = [];
  		var names = data[0].slice(1, data[0].length);
  		for (i = 0; i < names.length; i++){
  			fdata.push({key:names[i], values:[]});
  		}
		// identify x axis
		var parseX = str2int;
		var XisInt = 1
		if (!isNumber(data[1][0])){
			var lx = data[1][0].split(/[- :]/).length;
			if (lx >= 6) {
				parseX = time2int;
				XisInt = 0;
			}
			else if (lx >= 3){
				parseX = date2int;
				XisInt = 0;
			}
			else if (lx >= 2){
				parseX = month2int;
				XisInt = 0;
			}
			
		} 	
		

		for (i=1; i < data.length; i++) {
	        var row = data[i];
			var d = parseX(row[0]);
	        for (j=1; j < row.length; j++) {
	            if (row[j] != '') {
	            	fdata[j-1]["values"].push({ x: d, y: +row[j] });
	        	}
	       }
	        
	    }
		
		if (XisInt) {
			chart.xAxis.tickFormat(d3.format(',f'));
			chart.x2Axis.tickFormat(d3.format(',f'));
			}
			else {
				
				chart.xAxis.tickFormat(function(d) { 
					return d3.time.format("%Y-%m-%d")(new Date(d)); 
				});
			 
				chart.x2Axis.tickFormat(function(d) { 
					return d3.time.format("%Y-%m-%d")(new Date(d)); 
				});
			}
 		
 	d3.select('#svg-box svg')
      .datum(fdata)
      .transition().duration(500)
      .call(chart);
  });
 

  nv.utils.windowResize(chart.update);

  return chart;
});




</script>

</script>
{% endblock %}
