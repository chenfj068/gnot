{% extends "layout.html" %}
{% block title %}Scatter Plot{% endblock %}
{% block body %}

<link href="static/css/nv.d3.css" rel="stylesheet" type="text/css">
<script src="static/js/nv.d3.min.js"></script>

<style>
	#side-container {
		width:100px;
	}
	#side-container-4{
		background:#cbcbcb;
	}
	section{
		border:0px;
		padding:5px 0;
	}
	#legend{
		background:inherit;
		height:inherit;
	}
	#side_panel{
		padding:0px;
	}
	svg {
  		overflow: hidden;
  		height:800px;
	}
	
</style>

<h1>Explore Scatter</h1>
<div id="container">
	
<div id="main-container" style="width:960px;"><div id="svg-box"><svg></svg></div></div>
<div  id="side-container">
<div  class="side-container {{message_class}}" id="side-container-3">{{message}}</div>
<div class="side-container" id="side-container-0">{{title}}</div>
<div class="side-container" id="side-container-1"  >
	<p>Color corresponds to {{field4}}, and Size represents {{field3}}</p> 
</div>
<div  class="side-container" id="side-container-2">Built with <a href="http://d3js.org/">d3.js</a>.</div>
</div>
</div>


<script>
 nv.addGraph(function() {
 	var shapes = ['circle', 'cross', 'triangle-up', 'triangle-down', 'diamond', 'square'],
 		margin = {top: 20, right: 20, bottom: 40, left: 60},
	    width = 955,
	    height = 800;
	
 	var chart = nv.models.scatterChart()
 		.showDistX(true)
 		.showDistY(true)
		.width(width)
		.height(height)
		.margin(margin)
 		.color(d3.scale.category10().range());
 
 	chart.xAxis.tickFormat(d3.format('f'))
 	chart.yAxis.tickFormat(d3.format('f'))
   	chart.tooltipContent(function(key) {
		return '<h2>' + key + '</h2>';
  	});
  	
 	d3.csv("{{datfile}}", function(error, data) {
 		fd = {};
	  	data.forEach(function(d) {
	  		if (!(d.c in fd)){
	  			fd[d.c] = {key:d.c, values:[]};
	  		}
  			d.y = +d.y;
    		d.x = +d.x;
    		d.size = +d.z;
    		d.shape = shapes[0];
  			fd[d.c].values.push(d);
	  	});
	  	var fdvalues = Object.keys(fd).map(function(key){
    		return fd[key];
		});
		d3.select('#svg-box svg')
			.datum(fdvalues)
			.transition().duration(500)
			.call(chart);
		
	});
	chart.dispatch.on('stateChange', function(e) { ('New State:', JSON.stringify(e)); });
	nv.utils.windowResize(chart.update);
	return chart;
});

</script>
{% endblock %}