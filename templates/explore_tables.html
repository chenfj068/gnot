{% extends "layout.html" %}
{% block title %}Table Listing{% endblock %}
{% block body %}
<link rel="stylesheet" href="static/chosen.min.css">
<link rel="stylesheet" href="static/examples.css">

<style>

.top-container {
	width:700px;
	margin:0 auto;
	margin-top:120px;
	padding:10px;
	
	background: #a1c4fe;
	-moz-border-radius: 2px;
	-webkit-border-radius: 2px;
	border-radius: 2px;
	-moz-box-shadow: 0 2px 6px rgba(0,0,0,0.1);
	-ms-box-shadow: 0 2px 6px rgba(0,0,0,0.1);
	-webkit-box-shadow: 0 2px 6px rgba(0,0,0,0.1);
	box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}
.top-container div{
	display: inline-block;
	vertical-align: middle;
	font-family: Helvetica, sans-serif;
}
.left-badge{
	font-family: 'Josefin Sans', Helvetica, sans-serif;
	text-align:center;
	width:300px;
	text-rendering: optimizeLegibility;
}
.right-badge{
	padding:5px;
	text-align:left;
	width:380px;
	border-left:1px solid #eee;
}

.content div,input,select{
	margin: 5px 0px;
	text-align: left;
}
.typeahead{
	width: 80%;
	height: 16px;
	padding: 4px 12px;
	font-size: 14px;
	line-height: 16px;
	margin-left: 40px;
}
.submit-button{
	width: 50%;	
	background:#5e5ca6;
	color:white;
	font-size:16px;
	padding:4px;
	border:0px;
}

.textarea{
	margin: 2px 10px;
	width: 90%;
	border: 1px solid #eee;
	font-family: sans-serif;
	font-size:14px;
	padding:5px;
	font-family: 'Josefin Sans', Helvetica, sans-serif;
}
</style>


<style>


#navigation,
#content {
    float:left;
    margin:10px;
}

.collapsible,
.page_collapsible {
    margin: 0;
    padding:5px;

    background: #cccccc;
    text-decoration:none;
    color: #000;
    font-size:1.4em;
    cursor:pointer;
}

.collapse-open {
    background:#000;
    color: #fff;
}

.collapse-open span {
    display:block;
    float:right;
    padding:10px;
}

.collapse-open span {
    background:url(static/minus.png) center center no-repeat;
}

.collapse-close span {
    display:block;
    float:right;
    background:url(static/plus.png) center center no-repeat;
    padding:10px;
}

div.container {
    padding:0;
    margin:0;
}

div.content {
    background:#f0f0f0;
    margin: 0;
    padding:2px;
    border:0px;
    
    -moz-border-radius: 2px;
	-webkit-border-radius: 2px;
	border-radius: 2px;
	-moz-box-shadow: 0 2px 6px rgba(0,0,0,0.1);
	-ms-box-shadow: 0 2px 6px rgba(0,0,0,0.1);
	-webkit-box-shadow: 0 2px 6px rgba(0,0,0,0.1);
	box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

div.content ul, div.content p {
    margin: 2px 20px;
    padding:3px;
}

div.content ul li {
    list-style-position:inside;
    line-height:25px;
}

div.content ul li a {
    color:#555555;
}

code {
    overflow:auto;
}
.tt-suggestion{
	padding: 0px;
	font-size: 18px;
	line-height: 24px;
	width: 100%;
}


</style>

<div class="top-container">
<div class="left-badge">
	<h1>Explore Tables</h1>
	<p>DB visualization</p>
</div>
<div class="right-badge">
		<form id="form_module_tables" name="module_tables" action="module_tables" method="get" target="_blank">
		

		<div class="collapsible" id="section1">Core<span></span></div>
		<div class="container"><div class="content">
		
		<select id="select-table" name="table" data-placeholder="Choose a table" class="chosen-select" style="width:350px;" tabindex="1" required>
		<option value=""></option><option value="custom_view">from custom view</option>{{tables}}</select>
		

		<select id="select-module" name="module" data-placeholder="Choose a module" class="chosen-select" style="width:350px;" tabindex="2" required>
		<option value=""></option>{{modules}}</select>

	

		
		<div id="select_date_field">
		<select name="x_field" data-placeholder="Choose x-field " class="chosen-select"  style="width:350px;" tabindex="3"><option value=""></option></select>
		</div>
		<input  name="x_field" class="typeahead" type="text" placeholder="Or enter custom ..." autocomplete="on" spellcheck="true" dir="auto" style="position: relative; vertical-align: top; background-color: transparent;" tabindex="4" />

		<div id="select_field">
		<select name="field" data-placeholder="Choose fields" class="chosen-select" multiple style="width:350px;" tabindex="5"><option value=""></option></select>
		</div>
		<input  name="field" class="typeahead" type="text" placeholder="Or enter custom ..." autocomplete="on" spellcheck="true" dir="auto" style="position: relative; vertical-align: top; background-color: transparent;" tabindex="6" />

		
		<div id="select_sub_field">
		<select name="sub_field" data-placeholder="Choose sub fields" class="chosen-select" multiple style="width:350px;" tabindex="7"><option value=""></option></select>
		</div>
		<input name="sub_field" class="typeahead" type="text" placeholder="Or enter custom ..." autocomplete="on" spellcheck="true" dir="auto" style="position: relative; vertical-align: top; background-color: transparent;" tabindex="8"/>

		<div id="select_anot_field">
		<select name="anot_field" data-placeholder="Choose annotation fields" class="chosen-select" multiple style="width:350px;" tabindex="9"><option value=""></option></select>
		</div>
		<input name="anot_field" class="typeahead" type="text" placeholder="Or enter custom ..." autocomplete="on" spellcheck="true" dir="auto" style="position: relative; vertical-align: top; background-color: transparent;" tabindex="10"/>
		
		</div></div>
		
		<div class="collapsible" id="section2">Advanced<span></span></div>
		<div class="container"><div class="content">
		
		<textarea class="textarea" rows="2" cols="50" placeholder="where ..." name="where" tabindex="11"></textarea>
		
		<textarea class="textarea" rows="2" cols="50" placeholder="custom view ..." name="view" tabindex="11"></textarea>
		
		</div></div>
		<input class="submit-button" type="submit" value="submit" name="submit" tabindex="12">
		</form>

</div>
</div>

<script type="text/javascript" src="static/jquery.cookie.js"></script>
<script type="text/javascript" src="static/jquery.collapsible.js"></script>


<script src="static/chosen.jquery.min.js" type="text/javascript"></script>
<script src="static/typeahead.min.js" type="text/javascript"></script>
<script type="text/javascript">

	   $('.collapsible').collapsible({
            defaultOpen: 'section1',
            cookieName: 'nav',
            speed: 'fast'
        });
	
    var config = {
      '.chosen-select'           : {disable_search_threshold:10,allow_single_deselect:true},
      '.chosen-select-deselect'  : {allow_single_deselect:true},
      '.chosen-select-no-single' : {disable_search_threshold:10,no_results_text:'Oops, nothing found!'},
      '.chosen-select-no-results': {no_results_text:'Oops, nothing found!'},
      '.chosen-select-width'     : {width:"95%"}
    }
    for (var selector in config) {
      $(selector).chosen(config[selector]);
    }

	$(function(){
	  $("select#select-table").change(function(){
		  $('.typeahead').typeahead({                                
			  name: 'fields',                                                          
			  prefetch: 'explore?table=' + $(this).val() +'&ajax=true',                                         
			  limit: 10                                                                   
			});
		  
	    $.getJSON("explore",{table: $(this).val(), ajax: 'true'}, function(j){
	      
	      var options = ''
	      for (var i = 0; i < j.length; i++) {
	        options += '<option value="' + j[i] + '">' + j[i] + '</option>';
	      }
	      var foptions = '<select name="x_field" data-placeholder="Choose x-field ... " class="chosen-select" style="width:350px;" tabindex="2"><option value=""></option>';
	      foptions += options + '</select>'
	      $("#select_date_field").html(foptions);
	      
	      var foptions = '<select name="field" data-placeholder="Choose fields ... " class="chosen-select" multiple style="width:350px;" tabindex="2"><option value=""></option>';
	      foptions += options + '</select>'
	      $("#select_field").html(foptions);
	      
	      var foptions = '<select name="sub_field" data-placeholder="Choose sub fields ... " class="chosen-select" multiple style="width:350px;" tabindex="2"><option value=""></option>';
	      foptions += options + '</select>'
	      $("#select_sub_field").html(foptions);
	      
	      var foptions = '<select  name="anot_field" data-placeholder="Choose annotation fields ... " class="chosen-select" multiple style="width:350px;" tabindex="2"><option value=""></option>';
	      foptions += options + '</select>'
	      $("#select_anot_field").html(foptions);
	      
	      
	      
	      
	      for (var selector in config) {
	          $(selector).chosen(config[selector]);
	        }
	    })
	  })
	})
	
	$("#select-module").change(function() {
  		var action = $(this).val();
  		$("#form_module_tables").attr("action", action);
	});
</script>
{% endblock %}